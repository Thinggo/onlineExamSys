<script type="text/javascript">
	var modurl = "courseServlet.do";
    $(function () {
        //getButton("course");        
    	ui_course_init_list();
    });
	
    function ui_course_init_list(){
    	
        $("#ui_course_dg").datagrid({       //初始化datagrid
            url: modurl+"?action=search",
            striped: true, rownumbers: true, pagination: true, pageSize: 20,
            idField: 'id',
            sortName: 'id',
            sortOrder: 'desc',
            pageList: [20, 40, 60, 80, 100],
            frozenColumns: [[
                { field: 'ck', checkbox: true }
                
            ]],
            columns: [[
				{ field: 'name', title: '名称', sortable: true,width: 200 },
                { field: 'code', title: '编码', sortable: true, width: 100 },
                { field: 'deptName', title: '部门', sortable: true, width: 200},
                {
                    field: 'remark', title: '课程说明', width: 200,
                    formatter: function (value, row, index) {                    	
                        return value && value.length > 50 ? '<span title="' + value + '">' + value + '</span>' : value;
                    }
                }, 
          		{ field: 'teacherName', title: '教师', sortable: true, width: 130 },
          		{
                    field: 'courseStatus', title: '课程状态', width: 200,
                    formatter: function (value, row, index) {                     	
                    	if(value==1) return "审核通过";
                    	else if(value==2) return "考试";
                    	else if(value==3) return "练习";
                    	else return "未审核";
                    	
                    }
                }
            ]],
            //toolbar: toolbar.length == 0 ? null : toolbar
            toolbar: [{
                text: '添加',
                iconCls: 'icon-add',
                handler: function () { ui_course_add(); }
            }, {
                text: '修改',
                iconCls: 'icon-edit',
                handler: function () { ui_course_edit(); }
            }, {
                text: '删除',
                iconCls: 'icon-remove',
                handler: function () { ui_course_delete(); }
            },'-', {
                text: '审核',
                iconCls: 'icon-remove',
                handler: function () { ui_course_audit(); }
            }
            ]
        });       
    }
    //添加
    function ui_course_add() {
    	ui_dg_add_edit('添加课程','ui_course','courseServlet.do','courseEdit.html','add',460,300);  
    }
    //修改课程
    function ui_course_edit() {
    	var rows = $("#ui_course_dg").datagrid("getChecked");
        if (rows.length != 1) {
            $.show_warning("提示", "请先选择一门课程进行修改！");
            $("#ui_course_dg").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }
        var row = rows[0];
        /*
        if(row['courseStatus'] >= 2){
        	$.show_warning("提示", "课程已经审核通过，不能再修改！");
        	return;
        }
        */
        ui_dg_add_edit('修改课程','ui_course','courseServlet.do','courseEdit.html','edit',460,300,null,function(){
            	$("#ui_course_editform").form("load",row);
            });  
    }
    
  //删除区域
    function ui_course_delete() {
    	ui_dg_delete('课程','ui_course','courseServlet.do');        
    }
    
    function ui_course_audit(){
    	var rows = $("#ui_course_dg").datagrid("getChecked");
        if (rows.length < 1) {
            $.show_warning("提示", "请勾选要审核的课程");
            return;
        }
        $.messager.confirm('提示', '确定要审核通过勾选的这' + rows.length + '门课程吗？', function (r) {
            if (r) {
                para = {};
                para.action = "audit";
                para.timespan = new Date().getTime();

                var ids = [];
                $.each(rows, function (i, row) {
                    ids.push(row.id);
                });
                para.ids = ids.join(",");
                $.ajax({
                    url: modurl,
                    data: para,
                    type: "POST",
                    dataType: "json",
                    success: function (data) {
                        if (data.success) {
                            $.show_warning("提示", "审核成功！");
                            $("#ui_course_dg").datagrid("reload").datagrid('clearSelections').datagrid('clearChecked');
                        } else {
                            $.show_warning("提示", data.msg);
                        }
                    }
                });
            }
        });
    }
    
    
</script>
<div id="ui_layout" class="easyui-layout" data-options="fit:true,border:false">
    <div data-options="region:'center',border:false">
        <table id="ui_course_dg" data-options="fit:true,border:false">
        </table>
    </div>
</div>